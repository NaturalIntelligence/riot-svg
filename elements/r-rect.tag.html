<r-rect>
    <style>
        .draggable{
            cursor: move;
        }
        .resize-handler{
            fill: lavender;
            fill-opacity: 0.5;
            stroke: gray;
            stroke-width: 1px;
            vector-effect: non-scaling-stroke;
            r: 5
        }
        .ne { cursor: nesw-resize}
        .n { cursor: row-resize}
        .nw { cursor: nwse-resize}
        .e { cursor: col-resize}
        .w { cursor: col-resize}
        .se { cursor: nwse-resize}
        .s { cursor: row-resize}
        .sw { cursor: nesw-resize}
    </style>
    <rect ref="rect" onmousedown = {hold} class={draggable: draggable}/>
    <g if={resizable} class="resize-handlers">
        <circle class="resize-handler nw" ref="nw" ></circle>
        <circle class="resize-handler n" ref="n" ></circle>
        <circle class="resize-handler ne" ref="ne" ></circle>
        <circle class="resize-handler w" ref="w" ></circle>
        <circle class="resize-handler e" ref="e" ></circle>
        <circle class="resize-handler sw" ref="sw" ></circle>
        <circle class="resize-handler s" ref="s" ></circle>
        <circle class="resize-handler se" ref="se" ></circle>
    </g>

    <script>
        var tag = this;
        tag.diffX = 0;
        tag.diffY = 0;
        tag.dragStart = false;
        tag.hold = hold;
        tag.drag = drag;
        tag.release = release;
        tag.x= Number.parseInt(opts.x);
        tag.y= Number.parseInt(opts.y);
        tag.w= Number.parseInt(opts.width);
        tag.h= Number.parseInt(opts.height);
        tag._name= opts.name;
        tag.updatePosition = updatePosition;
        tag.setStartPosition = setStartPosition;
        tag.setResizeHandlersPosition = setResizeHandlersPosition;
        tag.draggable = opts.draggable === "true";
        tag.resizable = opts.resizable === "true";

        tag.on("mount", function(e) {
            tag.refs.rect.setAttribute("x", opts.x);
            tag.refs.rect.setAttribute("y", opts.y);
            tag.refs.rect.setAttribute("width", tag.w);
            tag.refs.rect.setAttribute("height", tag.h);
            opts.rx && (tag.refs.rect.setAttribute("rx", opts.rx) );
            opts.ry && (tag.refs.rect.setAttribute("ry", opts.ry) );
            tag.setResizeHandlersPosition();
        })

        function setResizeHandlersPosition(){
            if(tag.resizable){
                //East
                tag.refs.ne.setAttribute("cx", tag.x + tag.w);
                tag.refs.ne.setAttribute("cy", tag.y);
                
                tag.refs.e.setAttribute("cx", tag.x + tag.w);
                tag.refs.e.setAttribute("cy", tag.y + tag.h /2);

                tag.refs.se.setAttribute("cx", tag.x + tag.w);
                tag.refs.se.setAttribute("cy", tag.y + tag.h);
                
                //Middle
                tag.refs.n.setAttribute("cx", tag.x + tag.w / 2);
                tag.refs.n.setAttribute("cy", tag.y);
                
                tag.refs.s.setAttribute("cx", tag.x + tag.w / 2);
                tag.refs.s.setAttribute("cy", tag.y + tag.h);
                
                //West
                tag.refs.nw.setAttribute("cx", tag.x);
                tag.refs.nw.setAttribute("cy", tag.y);
                
                tag.refs.w.setAttribute("cx", tag.x);
                tag.refs.w.setAttribute("cy", tag.y + tag.h /2);

                tag.refs.sw.setAttribute("cx", tag.x);
                tag.refs.sw.setAttribute("cy", tag.y + tag.h);
            }
        }

        function updatePosition(cursor){
            //TODO: if keepWithIn is set then check if it is going out of container.
            tag.x = (cursor.x - tag.diffX);
            tag.y = (cursor.y - tag.diffY);

            /* cursor.target.setAttributeNS(null,"x", tag.x);
            cursor.target.setAttributeNS(null,"y", tag.y); */
            cursor.target.setAttribute("x", tag.x);
            cursor.target.setAttribute("y", tag.y);

            tag.setResizeHandlersPosition();
            
            //tag.update(); //it is required when there is any change in DOM element
        }

        function setStartPosition(cursor){
            tag.diffX = cursor.x - tag.x;
            tag.diffY = cursor.y - tag.y;
        }

        function hold(e){
            if(tag.draggable){
                tag.setStartPosition(e);
                e.target.addEventListener("mousemove", drag);
                e.target.addEventListener("mouseup", release);
            }
        }

        function drag(e){
            tag.updatePosition(e);
        }

        function release(e){
            e.target.removeEventListener("mousemove", drag);
            e.target.removeEventListener("mouseup", release);;
        }

        /*
        svg.addEventListener('touchstart', startDrag);
        svg.addEventListener('touchmove', drag);
        svg.addEventListener('touchend', endDrag);
        svg.addEventListener('touchleave', endDrag);
        svg.addEventListener('touchcancel', endDrag);
        */
    </script>
</r-rect>